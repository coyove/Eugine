import Util
import HttpServer

var rssCache = {}

(def Config() => {
    var this.port = 8080
    var this.socketReadTimeout = 5000
})()

println("listening on port ", Config.port)
var server = HttpServer("127.0.0.1", Config.port, Config.socketReadTimeout)

server.addRouter("GET", "_/", (context) => {
    context.writeCommon(200, "html")
    context.write("\r\n")
    for context.postParams do (k) =>
        context.write(k, "=", context.postParams[k], "<br>")
})
server.start()

// println(str(Digest.MD5("zzz")))

// var res = []
// var _zzz = -1

// def struct (f, args...) => {
//         f(args...)
//         clone f
//     }

// def [struct] zzz(a) => {
//     var b = a

//     def this.print() => sync res +> b
// }

// for 0..5000 do (i) => ((i) => {
//     zzz(i).print()
// })#(i)

// sleep(2000)

// var tmp = {}
// for res do (r) => tmp[r] = true
// res = []

// for tmp do (k) => res +> k

// enter println(range(1,0, zzz(1)))